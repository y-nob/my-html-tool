<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“èµ¤ç·šé•·ã•è¨ˆç®—ãƒ„ãƒ¼ãƒ«ï¼ˆãƒ¡ãƒ¼ãƒˆãƒ«å…¥åŠ›ç‰ˆï¼‰</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="container">
    <h1>ğŸ“èµ¤ç·šé•·ã•è¨ˆç®—ãƒ„ãƒ¼ãƒ«</h1>

    <label for="width">æ¨ªã®é•·ã• (m)</label>
    <input id="width" type="number" value="5.0" step="0.01" min="0.01">

    <label for="height">ç¸¦ã®é•·ã• (m)</label>
    <input id="height" type="number" value="3.0" step="0.01" min="0.01">

    <label for="angleSlider">è§’åº¦ (Â°)</label>
    <input id="angleSlider" type="range" min="1" max="89" value="45" step="1" oninput="updateAngle(this.value)">
    <div class="honbun">ç¾åœ¨ã®è§’åº¦: <span id="angleVal">45</span>Â°</div>

    <button onclick="draw()">èµ¤ç·šã‚’å†è¨ˆç®—</button>

    <div class="result">èµ¤ç·šã®é•·ã•: <span id="redLength">--</span> m</div>

    <svg id="canvas" width="600" height="400" style="margin-top:20px; border:1px solid #999;"></svg>

    <p>
      <a href="index.html">â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
    </p>
  </div>

  <script>
    const M_TO_PX = 100; // 1m = 100pxï¼ˆä¾‹ï¼šã‚¹ã‚±ãƒ¼ãƒ«èª¿æ•´ï¼‰

    function updateAngle(val) {
      document.getElementById("angleVal").textContent = val;
      draw();
    }

    function draw() {
      const w_m = parseFloat(document.getElementById("width").value);
      const h_m = parseFloat(document.getElementById("height").value);
      const angleDeg = parseFloat(document.getElementById("angleSlider").value);
      const angle = angleDeg * Math.PI / 180;

      const w = w_m * M_TO_PX;
      const h = h_m * M_TO_PX;

      const svg = document.getElementById("canvas");
      svg.setAttribute("width", w + 20);
      svg.setAttribute("height", h + 20);
      svg.innerHTML = "";

      const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
      rect.setAttribute("x", 10);
      rect.setAttribute("y", 10);
      rect.setAttribute("width", w);
      rect.setAttribute("height", h);
      rect.setAttribute("fill", "none");
      rect.setAttribute("stroke", "black");
      svg.appendChild(rect);

      const x1 = 10, y1 = 10;
      const dx2 = x1 + w, dy2 = y1 + Math.tan(angle) * w;

      const diag = document.createElementNS("http://www.w3.org/2000/svg", "line");
      diag.setAttribute("x1", x1);
      diag.setAttribute("y1", y1);
      diag.setAttribute("x2", dx2);
      diag.setAttribute("y2", dy2);
      diag.setAttribute("stroke", "black");
      svg.appendChild(diag);

      const rx = 10 + w, ry = 10;
      const dx = dx2 - x1;
      const dy = dy2 - y1;
      const len2 = dx * dx + dy * dy;

      const t = ((rx - x1) * dx + (ry - y1) * dy) / len2;
      const projX = x1 + t * dx;
      const projY = y1 + t * dy;

      const red = document.createElementNS("http://www.w3.org/2000/svg", "line");
      red.setAttribute("x1", rx);
      red.setAttribute("y1", ry);
      red.setAttribute("x2", projX);
      red.setAttribute("y2", projY);
      red.setAttribute("stroke", "red");
      red.setAttribute("stroke-width", 3);
      svg.appendChild(red);

      const lengthPx = Math.sqrt((rx - projX) ** 2 + (ry - projY) ** 2);
      const lengthM = lengthPx / M_TO_PX;
      document.getElementById("redLength").textContent = lengthM.toFixed(3);
    }

    draw();
  </script>
</body>
</html>
