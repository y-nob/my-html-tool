<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ğŸ“¸è¢«å†™ç•Œæ·±åº¦è¨ˆç®—</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>ğŸ“¸è¢«å†™ç•Œæ·±åº¦è¨ˆç®—</h1>
    <div class="container">
        <p>ç„¦ç‚¹è·é›¢ã€Få€¤ã€è¢«å†™ä½“è·é›¢ã€ã‚»ãƒ³ã‚µãƒ¼ã‚µã‚¤ã‚ºã‹ã‚‰è¢«å†™ç•Œæ·±åº¦ã‚’è¨ˆç®—ã—ã¾ã™ã€‚</p>

        <label for="focalLength">ç„¦ç‚¹è·é›¢ (mm)</label>
        <input type="number" id="focalLength" value="50">

        <label for="fNumber">Få€¤</label>
        <input type="number" step="0.1" id="fNumber" value="2.8">

        <label for="subjectDistance">è¢«å†™ä½“ã¾ã§ã®è·é›¢ (m)</label>
        <input type="number" step="0.1" id="subjectDistance" value="5">

        <label for="sensor">ã‚»ãƒ³ã‚µãƒ¼ã‚µã‚¤ã‚º</label>
        <select id="sensor" onchange="updateSensorSpecs()">
            <option value="full">ãƒ•ãƒ«ãƒ•ãƒ¬ãƒ¼ãƒ </option>
            <option value="aps_n">APS-C (Nikon/Sony)</option>
            <option value="aps_c">APS-C (Canon)</option>
            <option value="mft">MFT</option>
        </select>

        <label for="circleOfConfusion">è¨±å®¹éŒ¯ä¹±å††å¾„ (mm)</label>
        <input type="number" step="0.001" id="circleOfConfusion" value="0.030" readonly>

        <label for="sensorSize">ã‚»ãƒ³ã‚µãƒ¼ã‚µã‚¤ã‚º (mm)</label>
        <input type="text" id="sensorSize" value="36.0 Ã— 24.0" readonly>

        <button onclick="calculateAndRender()">è¨ˆç®—</button>

        <div class="result" id="dofResult"></div>
        <div id="svgContainer" style="margin-top:20px; text-align:center;"></div>

        <p style="margin-top:20px;">
            <a href="index.html">â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
        </p>
    </div>

    <script>
        const sensorSpecs = {
            "full":  { name: "ãƒ•ãƒ«ãƒ•ãƒ¬ãƒ¼ãƒ ",         coc: 0.030, width: 36.0, height: 24.0 },
            "aps_n": { name: "APS-C (Nikon/Sony)", coc: 0.020, width: 23.6, height: 15.7 },
            "aps_c": { name: "APS-C (Canon)",      coc: 0.019, width: 22.3, height: 14.9 },
            "mft":   { name: "MFT",                coc: 0.015, width: 17.3, height: 13.0 }
        };

        function updateSensorSpecs() {
            const key = document.getElementById("sensor").value;
            const spec = sensorSpecs[key];
            document.getElementById("circleOfConfusion").value = spec.coc.toFixed(3);
            document.getElementById("sensorSize").value = `${spec.width.toFixed(1)} Ã— ${spec.height.toFixed(1)}`;
        }

        function calculateAndRender() {
            const f = parseFloat(document.getElementById("focalLength").value); // mm
            const N = parseFloat(document.getElementById("fNumber").value);
            const s = parseFloat(document.getElementById("subjectDistance").value) * 1000; // m â†’ mm
            const key = document.getElementById("sensor").value;
            const spec = sensorSpecs[key];
            const c = spec.coc;
            const sensorW = spec.width;
            const sensorH = spec.height;

            if (isNaN(f) || isNaN(N) || isNaN(s) || isNaN(c)) {
                document.getElementById("dofResult").innerText = "ã™ã¹ã¦ã®é …ç›®ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚";
                return;
            }

            // 1. éç„¦ç‚¹è·é›¢ (H) ã‚’è¨ˆç®— (mm)
            // H = (f^2 / (N * c)) + f
            const H = (f * f) / (N * c) + f; // mm

            // 2. è¿‘ç‚¹ (Dn) ã‚’è¨ˆç®— (mm)
            // Dn = (H * s) / (H + (s - f))
            const Dn = (H * s) / (H + (s - f)); // mm

            // 3. é ç‚¹ (Df) ã‚’è¨ˆç®— (mm)
            // Df = (H * s) / (H - (s - f))
            const denominator_Df = H - (s - f);
            const Df = (denominator_Df > 0) ? (H * s) / denominator_Df : Infinity; // mm ã¾ãŸã¯ Infinity

            // çµæœã‚’ãƒ¡ãƒ¼ãƒˆãƒ«ã«å¤‰æ›
            const hyperfocal = H / 1000; // m
            const subjectDist_m = s / 1000; // m

            const near = Dn / 1000; // m
            const far = (Df === Infinity) ? Infinity : Df / 1000; // m
            const total = (far === Infinity) ? "âˆ" : ((far - near).toFixed(3) + " m");

            // å·®åˆ†è¨ˆç®—ï¼ˆè¢«å†™ä½“ã‹ã‚‰ã®å‰å¾Œè·é›¢ï¼‰
            const nearDiff = (subjectDist_m - near).toFixed(3); // m
            const farDiff = (far === Infinity) ? "âˆ" : (far - subjectDist_m).toFixed(3); // m

            // è¡¨ç¤ºï¼ˆãƒ†ã‚­ã‚¹ãƒˆï¼‰
            document.getElementById("dofResult").innerHTML = `
                <div class="result_matrix">
                    ã‚»ãƒ³ã‚µãƒ¼ï¼š${spec.name}ï¼ˆ${sensorW.toFixed(1)}mm Ã— ${sensorH.toFixed(1)}mmï¼‰<br>
                    è¨±å®¹éŒ¯ä¹±å††å¾„ï¼š${c.toFixed(3)} mm<br>
                    å‰æ–¹è¢«å†™ç•Œæ·±åº¦ï¼š${near.toFixed(3)} mï¼ˆ${nearDiff} mï¼‰<br>
                    å¾Œæ–¹è¢«å†™ç•Œæ·±åº¦ï¼š${far === Infinity ? "âˆ" : far.toFixed(3) + " m"}ï¼ˆ${farDiff} mï¼‰<br>
                    è¢«å†™ç•Œæ·±åº¦ï¼š${total}<br>
                    éç„¦ç‚¹è·é›¢ï¼š${hyperfocal.toFixed(1)} m
                </div>
            `;

            // SVGæç”»ã‚’å‰Šé™¤ (è¦æ±‚ã«å¿œã˜ã¦)
            document.getElementById("svgContainer").innerHTML = "";
        }

        // åˆæœŸåŒ–
        window.onload = updateSensorSpecs;
    </script>
</body>
</html>